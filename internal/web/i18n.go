package web

// i18nScript is injected into all pages for client-side language switching.
// Elements with data-i18n="key" get their textContent replaced.
// Elements with data-i18n-placeholder="key" get placeholder replaced.
// Dynamic content uses the i18n(key, ...args) function.
const i18nScript = `
<script>
const I18N = {
  zh: {
    // Common
    title: 'LiveSub',
    login: 'ç™»å½•',
    logout: 'é€€å‡ºç™»å½•',
    username: 'ç”¨æˆ·å',
    password: 'å¯†ç ',
    login_error: 'ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯',
    admin: 'âš™ï¸ ç®¡ç†',
    back: 'â† è¿”å›žæŽ§åˆ¶é¢æ¿',
    loading: 'åŠ è½½ä¸­...',
    refresh: 'åˆ·æ–°',
    confirm_delete: 'ç¡®å®šåˆ é™¤',
    save: 'ä¿å­˜',
    delete: 'åˆ é™¤',
    edit: 'ç¼–è¾‘',
    add: 'æ·»åŠ ',
    cancel: 'å–æ¶ˆ',
    name: 'åç§°',
    status: 'çŠ¶æ€',
    actions: 'æ“ä½œ',

    // Control panel
    control_panel: 'ðŸŽ™ï¸ LiveSub æŽ§åˆ¶é¢æ¿',
    no_rooms: 'æš‚æ— å¯æŸ¥çœ‹çš„ç›´æ’­é—´',
    room_default: 'ç›´æ’­é—´',
    live: 'ðŸ”´ ç›´æ’­ä¸­',
    offline: 'âš« æœªå¼€æ’­',
    translating: 'â–¶ï¸ ç¿»è¯‘ä¸­',
    paused: 'â¸ å·²æš‚åœ',
    waiting_voice: 'ç­‰å¾…è¯­éŸ³...',
    pause_btn: 'â¸ æš‚åœç¿»è¯‘',
    resume_btn: 'â–¶ï¸ æ¢å¤ç¿»è¯‘',
    account_label: 'ðŸ”‘ è´¦å·:',
    transcripts: 'ðŸ“„ å­—å¹•è®°å½•',
    no_transcripts: 'æš‚æ— å­—å¹•è®°å½•',
    download: 'â¬‡ ä¸‹è½½',
    filename: 'æ–‡ä»¶å',
    size: 'å¤§å°',
    time: 'æ—¶é—´',

    // Admin
    user_mgmt: 'âš™ï¸ ç”¨æˆ·ç®¡ç†',
    stream_mgmt: 'ðŸ“º ç›´æ’­é—´ç®¡ç†',
    user_list: 'ðŸ‘¥ ç”¨æˆ·åˆ—è¡¨',
    add_user: 'âž• æ·»åŠ ç”¨æˆ·',
    bili_accounts: 'ðŸŽ® Bç«™å¼¹å¹•è´¦å·',
    audit_log: 'ðŸ“‹ æ“ä½œè®°å½•',
    role: 'è§’è‰²',
    role_admin: 'ç®¡ç†å‘˜',
    role_user: 'æ™®é€šç”¨æˆ·',
    rooms: 'ç›´æ’­é—´',
    accounts: 'Bç«™è´¦å·',
    none: 'æ— ',
    room_id: 'æˆ¿é—´å·',
    lang: 'è¯­è¨€',
    source: 'æ¥æº',
    source_config: 'é…ç½®æ–‡ä»¶',
    source_webui: 'WebUI',
    add_stream: 'æ·»åŠ ç›´æ’­é—´',
    stream_name_ph: 'åç§° (å¦‚: å‘æ—¥è‘µ)',
    stream_url_ph: 'ç›´æ’­é—´URLæˆ–æˆ¿é—´å·',
    stream_added: 'å·²æ·»åŠ ',
    stream_confirm_del: 'ç¡®å®šåˆ é™¤ç›´æ’­é—´',
    stream_stop_warn: 'æ­£åœ¨è¿›è¡Œçš„ç¿»è¯‘ä¼šåœæ­¢',
    uid: 'UID',
    danmaku_max: 'å¼¹å¹•ä¸Šé™',
    created_at: 'æ·»åŠ æ—¶é—´',
    valid: 'æœ‰æ•ˆ',
    invalid: 'å·²å¤±æ•ˆ',
    qr_add: 'ðŸ“± æ‰«ç æ·»åŠ è´¦å·',
    qr_scan: 'è¯·ç”¨Bç«™æ‰‹æœºAPPæ‰«æäºŒç»´ç ',
    qr_scanned: 'âœ… å·²æ‰«ç ï¼Œè¯·åœ¨æ‰‹æœºä¸Šç¡®è®¤',
    qr_expired: 'äºŒç»´ç å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç”Ÿæˆ',
    qr_success: 'ç™»å½•æˆåŠŸï¼',
    confirm_del_account: 'ç¡®å®šåˆ é™¤Bç«™è´¦å·',
    no_bili_accounts: 'æš‚æ— è´¦å·ï¼Œç‚¹å‡»ä¸‹æ–¹æ‰«ç æ·»åŠ ',
    assign_rooms: 'åˆ†é…ç›´æ’­é—´:',
    assign_accounts: 'åˆ†é…Bç«™è´¦å·:',
    is_admin: 'ç®¡ç†å‘˜',
    fill_required: 'è¯·å¡«å†™ç”¨æˆ·åå’Œå¯†ç ',
    user_created: 'å·²åˆ›å»º',
    create_failed: 'åˆ›å»ºå¤±è´¥',
    new_password: 'æ–°å¯†ç  (ç•™ç©ºä¸æ”¹):',
    assign_rooms_prompt: 'åˆ†é…ç›´æ’­é—´ (è¾“å…¥åºå·ï¼Œé€—å·åˆ†éš”):',
    assign_accounts_prompt: 'åˆ†é…Bç«™è´¦å· (è¾“å…¥åºå·ï¼Œé€—å·åˆ†éš”):',
    confirm_del_user: 'ç¡®å®šåˆ é™¤ç”¨æˆ·',
    load_log: 'åŠ è½½è®°å½•',
    recent_50: 'æœ€è¿‘50æ¡',
    recent_100: 'æœ€è¿‘100æ¡',
    recent_500: 'æœ€è¿‘500æ¡',
    no_log: 'æš‚æ— è®°å½•',
    log_time: 'æ—¶é—´',
    log_user: 'ç”¨æˆ·',
    log_action: 'æ“ä½œ',
    log_detail: 'è¯¦æƒ…',
    log_ip: 'IP',
    no_room_input: 'æ— æ³•è¯†åˆ«æˆ¿é—´å·ï¼Œè¯·è¾“å…¥URLæˆ–æ•°å­—',
    fill_name: 'è¯·å¡«å†™åç§°',
  },

  en: {
    title: 'LiveSub',
    login: 'Login',
    logout: 'Logout',
    username: 'Username',
    password: 'Password',
    login_error: 'Invalid username or password',
    admin: 'âš™ï¸ Admin',
    back: 'â† Back to Control Panel',
    loading: 'Loading...',
    refresh: 'Refresh',
    confirm_delete: 'Confirm delete',
    save: 'Save',
    delete: 'Delete',
    edit: 'Edit',
    add: 'Add',
    cancel: 'Cancel',
    name: 'Name',
    status: 'Status',
    actions: 'Actions',

    control_panel: 'ðŸŽ™ï¸ LiveSub Control Panel',
    no_rooms: 'No rooms available',
    room_default: 'Room',
    live: 'ðŸ”´ Live',
    offline: 'âš« Offline',
    translating: 'â–¶ï¸ Translating',
    paused: 'â¸ Paused',
    waiting_voice: 'Waiting for audio...',
    pause_btn: 'â¸ Pause',
    resume_btn: 'â–¶ï¸ Resume',
    account_label: 'ðŸ”‘ Account:',
    transcripts: 'ðŸ“„ Transcripts',
    no_transcripts: 'No transcripts yet',
    download: 'â¬‡ Download',
    filename: 'Filename',
    size: 'Size',
    time: 'Time',

    user_mgmt: 'âš™ï¸ User Management',
    stream_mgmt: 'ðŸ“º Stream Management',
    user_list: 'ðŸ‘¥ Users',
    add_user: 'âž• Add User',
    bili_accounts: 'ðŸŽ® Bilibili Accounts',
    audit_log: 'ðŸ“‹ Audit Log',
    role: 'Role',
    role_admin: 'Admin',
    role_user: 'User',
    rooms: 'Rooms',
    accounts: 'Accounts',
    none: 'None',
    room_id: 'Room ID',
    lang: 'Language',
    source: 'Source',
    source_config: 'Config',
    source_webui: 'WebUI',
    add_stream: 'Add Stream',
    stream_name_ph: 'Name (e.g. VTuber A)',
    stream_url_ph: 'Live room URL or room ID',
    stream_added: 'Added',
    stream_confirm_del: 'Delete stream',
    stream_stop_warn: 'Active translation will stop',
    uid: 'UID',
    danmaku_max: 'Max Length',
    created_at: 'Created',
    valid: 'Valid',
    invalid: 'Expired',
    qr_add: 'ðŸ“± QR Code Login',
    qr_scan: 'Scan with Bilibili mobile app',
    qr_scanned: 'âœ… Scanned, please confirm on phone',
    qr_expired: 'QR code expired, please regenerate',
    qr_success: 'Login successful!',
    confirm_del_account: 'Delete Bilibili account',
    no_bili_accounts: 'No accounts. Click below to add via QR.',
    assign_rooms: 'Assign rooms:',
    assign_accounts: 'Assign accounts:',
    is_admin: 'Admin',
    fill_required: 'Username and password required',
    user_created: 'Created',
    create_failed: 'Creation failed',
    new_password: 'New password (leave blank to keep):',
    assign_rooms_prompt: 'Assign rooms (enter numbers, comma-separated):',
    assign_accounts_prompt: 'Assign accounts (enter numbers, comma-separated):',
    confirm_del_user: 'Delete user',
    load_log: 'Load Log',
    recent_50: 'Last 50',
    recent_100: 'Last 100',
    recent_500: 'Last 500',
    no_log: 'No records',
    log_time: 'Time',
    log_user: 'User',
    log_action: 'Action',
    log_detail: 'Detail',
    log_ip: 'IP',
    no_room_input: 'Cannot parse room ID. Enter URL or number.',
    fill_name: 'Please enter a name',
  },

  ja: {
    title: 'LiveSub',
    login: 'ãƒ­ã‚°ã‚¤ãƒ³',
    logout: 'ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ',
    username: 'ãƒ¦ãƒ¼ã‚¶ãƒ¼å',
    password: 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰',
    login_error: 'ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™',
    admin: 'âš™ï¸ ç®¡ç†',
    back: 'â† ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ«ã«æˆ»ã‚‹',
    loading: 'èª­ã¿è¾¼ã¿ä¸­...',
    refresh: 'æ›´æ–°',
    confirm_delete: 'å‰Šé™¤ã—ã¾ã™ã‹',
    save: 'ä¿å­˜',
    delete: 'å‰Šé™¤',
    edit: 'ç·¨é›†',
    add: 'è¿½åŠ ',
    cancel: 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«',
    name: 'åå‰',
    status: 'ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹',
    actions: 'æ“ä½œ',

    control_panel: 'ðŸŽ™ï¸ LiveSub ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ«',
    no_rooms: 'è¡¨ç¤ºã§ãã‚‹é…ä¿¡ãƒ«ãƒ¼ãƒ ãŒã‚ã‚Šã¾ã›ã‚“',
    room_default: 'é…ä¿¡ãƒ«ãƒ¼ãƒ ',
    live: 'ðŸ”´ é…ä¿¡ä¸­',
    offline: 'âš« ã‚ªãƒ•ãƒ©ã‚¤ãƒ³',
    translating: 'â–¶ï¸ ç¿»è¨³ä¸­',
    paused: 'â¸ ä¸€æ™‚åœæ­¢',
    waiting_voice: 'éŸ³å£°å¾…æ©Ÿä¸­...',
    pause_btn: 'â¸ ä¸€æ™‚åœæ­¢',
    resume_btn: 'â–¶ï¸ å†é–‹',
    account_label: 'ðŸ”‘ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ:',
    transcripts: 'ðŸ“„ å­—å¹•è¨˜éŒ²',
    no_transcripts: 'å­—å¹•è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“',
    download: 'â¬‡ DL',
    filename: 'ãƒ•ã‚¡ã‚¤ãƒ«å',
    size: 'ã‚µã‚¤ã‚º',
    time: 'æ—¥æ™‚',

    user_mgmt: 'âš™ï¸ ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†',
    stream_mgmt: 'ðŸ“º é…ä¿¡ãƒ«ãƒ¼ãƒ ç®¡ç†',
    user_list: 'ðŸ‘¥ ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§',
    add_user: 'âž• ãƒ¦ãƒ¼ã‚¶ãƒ¼è¿½åŠ ',
    bili_accounts: 'ðŸŽ® Bilibiliã‚¢ã‚«ã‚¦ãƒ³ãƒˆ',
    audit_log: 'ðŸ“‹ æ“ä½œãƒ­ã‚°',
    role: 'æ¨©é™',
    role_admin: 'ç®¡ç†è€…',
    role_user: 'ä¸€èˆ¬',
    rooms: 'é…ä¿¡ãƒ«ãƒ¼ãƒ ',
    accounts: 'ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ',
    none: 'ãªã—',
    room_id: 'ãƒ«ãƒ¼ãƒ ID',
    lang: 'è¨€èªž',
    source: 'ã‚½ãƒ¼ã‚¹',
    source_config: 'è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«',
    source_webui: 'WebUI',
    add_stream: 'é…ä¿¡ã‚’è¿½åŠ ',
    stream_name_ph: 'åå‰ (ä¾‹: VTuber A)',
    stream_url_ph: 'é…ä¿¡URLã¾ãŸã¯ãƒ«ãƒ¼ãƒ ID',
    stream_added: 'è¿½åŠ ã—ã¾ã—ãŸ',
    stream_confirm_del: 'é…ä¿¡ãƒ«ãƒ¼ãƒ ã‚’å‰Šé™¤',
    stream_stop_warn: 'ç¿»è¨³ä¸­ã®é…ä¿¡ã¯åœæ­¢ã—ã¾ã™',
    uid: 'UID',
    danmaku_max: 'æœ€å¤§æ–‡å­—æ•°',
    created_at: 'ä½œæˆæ—¥',
    valid: 'æœ‰åŠ¹',
    invalid: 'æœŸé™åˆ‡ã‚Œ',
    qr_add: 'ðŸ“± QRã‚³ãƒ¼ãƒ‰ãƒ­ã‚°ã‚¤ãƒ³',
    qr_scan: 'Bilibiliã‚¢ãƒ—ãƒªã§ã‚¹ã‚­ãƒ£ãƒ³',
    qr_scanned: 'âœ… ã‚¹ã‚­ãƒ£ãƒ³æ¸ˆã¿ã€ã‚¹ãƒžãƒ›ã§ç¢ºèªã—ã¦ãã ã•ã„',
    qr_expired: 'QRã‚³ãƒ¼ãƒ‰ã®æœŸé™ãŒåˆ‡ã‚Œã¾ã—ãŸ',
    qr_success: 'ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸï¼',
    confirm_del_account: 'ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’å‰Šé™¤',
    no_bili_accounts: 'ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒã‚ã‚Šã¾ã›ã‚“ã€‚ä¸‹ã®ãƒœã‚¿ãƒ³ã§QRãƒ­ã‚°ã‚¤ãƒ³',
    assign_rooms: 'ãƒ«ãƒ¼ãƒ å‰²å½“:',
    assign_accounts: 'ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå‰²å½“:',
    is_admin: 'ç®¡ç†è€…',
    fill_required: 'ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„',
    user_created: 'ä½œæˆã—ã¾ã—ãŸ',
    create_failed: 'ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ',
    new_password: 'æ–°ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ (ç©ºæ¬„ã§å¤‰æ›´ãªã—):',
    assign_rooms_prompt: 'ãƒ«ãƒ¼ãƒ å‰²å½“ (ç•ªå·ã‚’ã‚«ãƒ³ãƒžåŒºåˆ‡ã‚Š):',
    assign_accounts_prompt: 'ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå‰²å½“ (ç•ªå·ã‚’ã‚«ãƒ³ãƒžåŒºåˆ‡ã‚Š):',
    confirm_del_user: 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å‰Šé™¤',
    load_log: 'ãƒ­ã‚°èª­è¾¼',
    recent_50: 'æœ€æ–°50ä»¶',
    recent_100: 'æœ€æ–°100ä»¶',
    recent_500: 'æœ€æ–°500ä»¶',
    no_log: 'è¨˜éŒ²ãªã—',
    log_time: 'æ—¥æ™‚',
    log_user: 'ãƒ¦ãƒ¼ã‚¶ãƒ¼',
    log_action: 'æ“ä½œ',
    log_detail: 'è©³ç´°',
    log_ip: 'IP',
    no_room_input: 'ãƒ«ãƒ¼ãƒ IDã‚’èªè­˜ã§ãã¾ã›ã‚“ã€‚URLã¾ãŸã¯æ•°å­—ã‚’å…¥åŠ›',
    fill_name: 'åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„',
  }
};

let currentLang = localStorage.getItem('livesub_lang') || 'zh';

function t(key) {
  return (I18N[currentLang] && I18N[currentLang][key]) || (I18N.zh[key]) || key;
}

function setLang(lang) {
  currentLang = lang;
  localStorage.setItem('livesub_lang', lang);
  document.querySelectorAll('[data-i18n]').forEach(el => {
    el.textContent = t(el.dataset.i18n);
  });
  document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
    el.placeholder = t(el.dataset['i18nPlaceholder']);
  });
  document.querySelectorAll('[data-i18n-title]').forEach(el => {
    el.title = t(el.dataset['i18nTitle']);
  });
  // Update lang buttons
  document.querySelectorAll('.lang-btn').forEach(b => {
    b.classList.toggle('active', b.dataset.lang === lang);
  });
  // Trigger page-specific refresh if defined
  if (typeof onLangChange === 'function') onLangChange();
}

function langSwitcher() {
  return '<div class="lang-switch">' +
    '<button class="lang-btn' + (currentLang==='zh'?' active':'') + '" data-lang="zh" onclick="setLang(\'zh\')">ä¸­æ–‡</button>' +
    '<button class="lang-btn' + (currentLang==='en'?' active':'') + '" data-lang="en" onclick="setLang(\'en\')">EN</button>' +
    '<button class="lang-btn' + (currentLang==='ja'?' active':'') + '" data-lang="ja" onclick="setLang(\'ja\')">æ—¥æœ¬èªž</button>' +
  '</div>';
}
</script>
<style>
.lang-switch { display: flex; gap: 4px; align-items: center; }
.lang-btn { padding: 4px 10px; border: 1px solid #444; border-radius: 4px; background: transparent; color: #aaa; cursor: pointer; font-size: 12px; line-height: 1; display: inline-flex; align-items: center; justify-content: center; }
.lang-btn:hover { border-color: #e94560; color: #eee; }
.lang-btn.active { background: #e94560; color: #fff; border-color: #e94560; }
</style>`
