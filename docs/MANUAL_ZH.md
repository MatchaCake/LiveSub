# LiveSub 用户手册

> 📖 [English](MANUAL_EN.md) | [日本語](MANUAL_JA.md)

## 目录

1. [快速上手](#zh-getting-started)
2. [了解主页面](#zh-main-page)
3. [暂停与恢复输出](#zh-pause-resume)
4. [3秒延迟队列](#zh-delay-queue)
5. [序号表情开关](#zh-show-seq)
6. [下载字幕记录](#zh-transcripts)
7. [设置页面（管理输出）](#zh-settings)
8. [管理员功能](#zh-admin)
9. [弹幕指令](#zh-commands)
10. [常见问题](#zh-troubleshooting)

---

<h3 id="zh-getting-started">1. 快速上手</h3>

#### 登录

打开浏览器，输入管理员告诉你的地址（通常是 `http://服务器IP:8899`）。你会看到登录页面。

[Screenshot: 登录页面 — 深色背景，中间有用户名和密码输入框，右上角有中文/EN/日本語语言切换]

1. 在右上角可以切换界面语言（**中文** / **EN** / **日本語**）
2. 输入你的 **用户名** 和 **密码**
3. 点击 **登录** 按钮

> 登录后 7 天内无需重新登录，即使服务重启也不受影响。

#### 初次进入主页面

登录成功后，你会自动跳转到 **控制面板**。根据你的角色，你会看到不同的内容：

- **管理员**：可以看到所有直播间、所有账号，并且右上角有「⚙️ 管理」按钮
- **普通用户**：只能看到管理员分配给你的直播间

---

<h3 id="zh-main-page">2. 了解主页面</h3>

控制面板是你最常用的页面。它展示了所有直播间的翻译状态。

[Screenshot: 控制面板主页 — 顶部标题栏，下方是多个直播间卡片]

#### 页面结构

- **顶部栏**：标题、语言切换、用户名、管理入口、退出登录
- **直播间卡片**：每个配置的主播对应一张卡片
- **字幕记录区**：页面底部可下载历史字幕文件

#### 直播间卡片

每张卡片包含：

| 元素 | 说明 |
|------|------|
| **主播名称** | 卡片左上角，如「VTuber A」 |
| **房间号** | 卡片右上角的 `#12345` |
| **直播状态** | 🔴 **直播中**（红色标签）或 ⚫ **未开播**（灰色标签） |
| **输出卡片** | 每个翻译输出对应一张小卡片（见下文） |

#### 输出卡片

每个输出卡片展示一个翻译通道的状态：

[Screenshot: 输出卡片 — 显示名称、平台信息、翻译状态标签、待发送/已发送消息、暂停按钮]

| 元素 | 说明 |
|------|------|
| **输出名称** | 如「中文翻译」「English」 |
| **信息行** | `bilibili | zh-CN | 🔑 账号: bot1` |
| **状态标签** | ▶️ **翻译中**（蓝色）或 ⏸ **已暂停**（橙色） |
| **待发送** | 延迟队列中等待发送的消息（详见第4节） |
| **已发送** | 最近成功发送的5条弹幕 |
| **操作按钮** | ⏸ 暂停翻译 / ▶️ 恢复翻译 |
| **序号开关** | 显示序号 0️⃣~🔟 复选框 |

> 如果输出配置了多个账号轮发，信息行会显示如 `bot1, bot2 (2个轮发)`。

---

<h3 id="zh-pause-resume">3. 暂停与恢复输出</h3>

你可以随时暂停或恢复任何一个翻译输出。

#### 从网页暂停

1. 找到你想控制的输出卡片
2. 点击底部的 **⏸ 暂停翻译** 按钮
3. 状态标签会变为橙色的「⏸ 已暂停」
4. 按钮变为 **▶️ 恢复翻译**

[Screenshot: 暂停状态的输出卡片 — 橙色「已暂停」标签，绿色「恢复翻译」按钮]

#### 注意事项

- 暂停后，翻译仍在后台进行，**字幕记录会继续写入 CSV 文件**，只是不发送弹幕
- 暂停/恢复操作会被记录在审计日志中
- 即使主播下播再开播，暂停状态会保持（不会自动恢复）

---

<h3 id="zh-delay-queue">4. 3秒延迟队列</h3>

为了让你有机会在弹幕发出前审核内容，每条翻译会先在 **待发送** 队列中停留约 3 秒。

#### 待发送区域

当有消息在队列中时，输出卡片会显示一个红色的 **⏳ 待发送** 区域：

[Screenshot: 待发送队列 — 红色标题，每条消息显示倒计时秒数和跳过按钮]

- 每条消息显示剩余等待时间，如 `2s | 今天天气真好呢`
- 右侧有 **跳过** 按钮

#### 跳过消息

如果你看到一条不合适的翻译，点击 **跳过** 按钮即可取消发送。消息将被丢弃，不会以弹幕形式发出。

#### 已发送区域

消息成功发送后，会出现在绿色的 **✅ 已发送** 区域，最多显示最近 5 条，方便你确认弹幕内容。

---

<h3 id="zh-show-seq">5. 序号表情开关</h3>

开启后，每条弹幕前面会加上数字表情（0️⃣ 1️⃣ 2️⃣ ... 🔟），帮助观众区分不同句子的先后顺序。

#### 使用方法

1. 在输出卡片底部找到 **显示序号 0️⃣~🔟** 复选框
2. 勾选即开启，取消勾选即关闭
3. 设置会自动保存

#### 效果示例

开启前：
```
【翻译】大家好
【翻译】今天天气真好呢
```

开启后：
```
【翻译】1️⃣ 大家好
【翻译】2️⃣ 今天天气真好呢
```

> 序号到 🔟 后会循环回 0️⃣。序号出现在用户前缀之后。

---

<h3 id="zh-transcripts">6. 下载字幕记录</h3>

每次直播会自动生成字幕记录文件（CSV 格式），记录每句翻译的原文和译文。

#### 下载方法

1. 在控制面板底部找到 **📄 字幕记录** 区域
2. 点击 **刷新** 按钮加载文件列表
3. 找到你需要的文件，点击 **⬇ 下载**

[Screenshot: 字幕记录区域 — 文件名、大小、时间、下载按钮的表格]

#### 文件格式

文件名格式：`房间号_主播名_日期_时间.csv`

例如：`12345_VTuberA_20260219_143000.csv`

CSV 包含以下列：

| 列 | 说明 |
|----|------|
| 时间 | 翻译发生的实际时间 |
| 时间轴 | 从开播算起的时间偏移 |
| 原文语言 | 如 `ja-JP` |
| 原文 | 识别到的原始语音内容 |
| 目标语言 | 如 `zh-CN` |
| 翻译 | 翻译后的文本 |

> 文件使用 UTF-8 编码（带 BOM），可以直接用 Excel 打开不乱码。

> 普通用户只能下载自己被分配的直播间的字幕记录。

---

<h3 id="zh-settings">7. 设置页面（管理输出）</h3>

输出管理功能已合并到管理面板中。普通用户和管理员都可以在管理面板的 **📤 输出管理** 区域管理自己有权限的直播间的输出。

#### 进入管理面板

点击页面右上角的 **⚙️ 管理** 按钮进入管理面板。

> 普通用户进入后，只会看到「📤 输出管理」区域。管理员才能看到所有管理功能。

#### 管理输出

[Screenshot: 输出管理区域 — 顶部有主播选择下拉框，下方是输出列表和添加表单]

1. **选择主播**：从下拉框选择你要管理的主播
2. **查看现有输出**：表格显示所有输出的名称、平台、目标语言、账号、房间号、前缀、后缀
3. **添加/编辑输出**：

| 字段 | 说明 |
|------|------|
| 名称 | 输出的显示名称，如「中文翻译」 |
| 平台 | 目前只有 `bilibili` |
| 目标语言 | 翻译目标语言（留空则直传原文） |
| 账号 | 选择一个或多个B站账号（多选即为轮发模式） |
| 房间号 | 发送弹幕的目标房间（0 = 主播所在房间） |
| 前缀 | 弹幕前面加的文字，如 `【翻译】` |
| 后缀 | 弹幕后面加的文字 |

4. 填写完成后点击 **保存**
5. 要删除某个输出，点击对应行的 **删除** 按钮

> 新添加的输出默认处于暂停状态，需要在控制面板手动恢复。

---

<h3 id="zh-admin">8. 管理员功能</h3>

> 以下功能仅限管理员角色使用。

点击控制面板右上角的 **⚙️ 管理** 进入管理面板。

[Screenshot: 管理面板全景 — 多个区域：主播管理、输出管理、用户列表、B站账号、操作记录]

#### 📺 主播管理

| 操作 | 说明 |
|------|------|
| 查看 | 表格显示所有主播的名称、房间号、识别语言、输出列表、指令白名单 |
| 添加 | 填写主播名称、房间号（支持 URL 或数字）、识别语言，点击保存 |
| 编辑 | 点击某个主播的 **编辑** 按钮，表单会自动填入现有配置 |
| 删除 | 点击 **删除** 并确认 |
| 指令白名单 | 填写允许使用弹幕指令的 B站 UID（逗号分隔） |

#### 👥 用户管理

| 操作 | 说明 |
|------|------|
| 查看 | 表格显示用户名、角色、已分配的账号和直播间 |
| 添加用户 | 填写用户名、密码，勾选是否为管理员，分配B站账号和直播间 |
| 编辑用户 | 点击 **编辑**，弹窗修改密码、重新分配账号/直播间 |
| 删除用户 | 点击 **删除** 并确认（管理员账号不可删除） |

#### 权限说明

| 角色 | 直播间 | 账号 | 字幕记录 | 管理面板 |
|------|--------|------|----------|----------|
| 管理员 | 全部 | 全部 | 全部 | 完整访问 |
| 普通用户 | 仅分配的 | 仅分配的 | 仅分配的直播间 | 仅输出管理 |

#### 🎮 B站弹幕账号

用于管理发送弹幕的 B站账号。

**添加账号（扫码登录）：**

1. 点击 **📱 扫码添加账号** 按钮
2. 页面会显示一个二维码
3. 用 **B站手机 APP** 扫描这个二维码
4. 在手机上确认登录
5. 登录成功后，账号会自动添加到列表

[Screenshot: QR 扫码登录 — 二维码图片居中，下方有「已扫码，请在手机上确认」提示]

**管理已有账号：**

| 列 | 说明 |
|----|------|
| 名称 | 账号昵称 |
| UID | B站用户 ID |
| 弹幕上限 | 每条弹幕的最大字符数（默认 20，UL20+ 可设为 30） |
| 添加时间 | 账号添加的时间 |
| 状态 | **有效** 或 **已失效** |

> 弹幕上限可以直接在表格中修改，改完后自动保存。

#### 📋 操作记录（审计日志）

记录所有用户的操作，包括登录、暂停/恢复翻译、添加/删除账号等。

1. 选择显示条数（最近 50 / 100 / 500 条）
2. 点击 **加载记录**
3. 查看操作时间、用户、操作类型、详情和 IP 地址

---

<h3 id="zh-commands">9. 弹幕指令</h3>

除了网页操作，你还可以直接在B站直播间的弹幕中发送指令来控制翻译。

> 只有在配置中加入了你的 B站 UID 的白名单用户才能使用指令。

#### 指令列表

| 指令 | 别名 | 功能 |
|------|------|------|
| `/off` | `/pause` `/暂停` | 暂停所有翻译输出 |
| `/on` | `/resume` `/恢复` | 恢复所有翻译输出 |
| `/off 名称` | `/pause 名称` `/暂停 名称` | 暂停指定输出（如 `/off 中文翻译`） |
| `/on 名称` | `/resume 名称` `/恢复 名称` | 恢复指定输出 |
| `/list` | `/列表` | 查看所有输出的 ▶/⏸ 状态 |
| `/help` | `/帮助` | 显示指令帮助信息 |

#### 使用示例

在B站直播间的弹幕框中输入：

- 暂停所有翻译：发送 `/off`
- 只暂停中文翻译：发送 `/off 中文翻译`
- 恢复所有翻译：发送 `/on`
- 查看当前状态：发送 `/list`，机器人会回复如 `▶中文翻译 | ⏸English`

> 指令回复由账号池轮发，以提高速度和避免频率限制。

---

<h3 id="zh-troubleshooting">10. 常见问题</h3>

#### 登录不上去

- 检查用户名和密码是否正确（区分大小写）
- 如果忘记密码，联系管理员重置
- 检查浏览器是否允许 Cookie

#### 看不到直播间

- 普通用户只能看到管理员分配给你的直播间
- 联系管理员检查你的权限配置

#### 翻译没有在弹幕中出现

- 检查输出是否处于 **暂停** 状态（橙色标签）
- 检查主播是否在 **直播中**（红色标签）
- 翻译需要主播说话并被语音识别成功
- 检查B站账号状态是否 **有效**
- 新添加的输出默认暂停，需要手动恢复

#### 弹幕显示不完整

- 弹幕有字数限制（默认 20 字，UL20+ 账号可设为 30 字）
- 超长翻译会自动拆分为多条弹幕发送
- 前缀和后缀也占用字数

#### 弹幕指令没有反应

- 确认你的 B站 UID 在该主播的指令白名单中
- 指令需要以 `/` 开头
- 主播当前必须在直播中

#### 字幕记录看不到

- 点击字幕记录区域的 **刷新** 按钮
- 字幕记录只在主播直播时生成
- 普通用户只能看到自己被分配的直播间的记录

#### 页面数据没有更新

- LiveSub 使用 WebSocket 实时推送状态更新
- 如果长时间未更新，尝试刷新页面
- 后台还有 5 秒一次的轮询作为备用
