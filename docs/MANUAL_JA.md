# LiveSub ユーザーマニュアル

> 📖 [中文](MANUAL_ZH.md) | [English](MANUAL_EN.md)

## 目次

1. [はじめに](#ja-getting-started)
2. [メインページの見方](#ja-main-page)
3. [出力の一時停止と再開](#ja-pause-resume)
4. [3秒遅延キュー](#ja-delay-queue)
5. [番号絵文字の切り替え](#ja-show-seq)
6. [字幕記録のダウンロード](#ja-transcripts)
7. [設定ページ（出力管理）](#ja-settings)
8. [管理者機能](#ja-admin)
9. [弾幕コマンド](#ja-commands)
10. [よくある質問](#ja-troubleshooting)

---

<h3 id="ja-getting-started">1. はじめに</h3>

#### ログイン

ブラウザを開いて、管理者から教えてもらったアドレス（通常は `http://サーバーIP:8899`）にアクセスします。ログインページが表示されます。

[Screenshot: ログインページ — ダークテーマの背景、中央にユーザー名とパスワードの入力欄、右上に中文/EN/日本語の言語切替]

1. 右上で表示言語を切り替えられます（**中文** / **EN** / **日本語**）
2. **ユーザー名** と **パスワード** を入力します
3. **ログイン** ボタンをクリックします

> 一度ログインすると、サービスが再起動しても 7日間 はログイン状態が維持されます。

#### ダッシュボードの初見

ログインすると **コントロールパネル** に移動します。あなたの権限によって表示内容が異なります：

- **管理者**：すべての配信ルームが表示され、右上に「⚙️ 管理」ボタンがあります
- **一般ユーザー**：管理者から割り当てられた配信ルームのみ表示されます

---

<h3 id="ja-main-page">2. メインページの見方</h3>

コントロールパネルは最もよく使うページです。各配信ルームのリアルタイム翻訳状況を確認できます。

[Screenshot: コントロールパネル — 上部にタイトルバー、下部に配信者カードが並ぶ]

#### ページの構成

- **上部バー**：タイトル、言語切替、ユーザー名、管理画面リンク、ログアウト
- **配信者カード**：設定された配信者ごとに1枚のカード
- **字幕記録エリア**：ページ下部で過去の字幕ファイルをダウンロード

#### 配信者カード

各カードの要素：

| 要素 | 説明 |
|------|------|
| **配信者名** | カード左上（例：「VTuber A」） |
| **ルームID** | カード右上の `#12345` |
| **配信状態** | 🔴 **配信中**（赤いバッジ）または ⚫ **オフライン**（グレーバッジ） |
| **出力カード** | 各翻訳出力に対応するミニカード（後述） |

#### 出力カード

各出力カードは、翻訳チャンネルのステータスを表示します：

[Screenshot: 出力カード — 名前、プラットフォーム情報、翻訳状態バッジ、送信待ち/送信済みメッセージ、一時停止ボタン]

| 要素 | 説明 |
|------|------|
| **出力名** | 例：「中文翻訳」「English」 |
| **情報行** | `bilibili | zh-CN | 🔑 アカウント: bot1` |
| **状態バッジ** | ▶️ **翻訳中**（青）または ⏸ **一時停止**（オレンジ） |
| **送信待ち** | 遅延キューで待機中のメッセージ（第4節参照） |
| **送信済み** | 最近送信された弾幕5件 |
| **操作ボタン** | ⏸ 一時停止 / ▶️ 再開 |
| **番号切替** | 「番号表示 0️⃣~🔟」チェックボックス |

> 出力に複数のアカウントが設定されている場合、情報行に `bot1, bot2 (2アカウント輪番)` のように表示されます。

---

<h3 id="ja-pause-resume">3. 出力の一時停止と再開</h3>

いつでも翻訳出力を一時停止・再開できます。

#### Webページから一時停止

1. 操作したい出力カードを見つけます
2. カード下部の **⏸ 一時停止** ボタンをクリックします
3. 状態バッジがオレンジの「⏸ 一時停止」に変わります
4. ボタンが **▶️ 再開** に変わります

[Screenshot: 一時停止中の出力カード — オレンジの「一時停止」バッジ、緑の「再開」ボタン]

#### 注意点

- 一時停止中も翻訳はバックグラウンドで動作し、**字幕記録のCSVファイルへの書き込みは継続されます**。弾幕の送信のみが停止します
- 一時停止/再開の操作は監査ログに記録されます
- 配信者がオフラインになって再開しても、一時停止状態は維持されます（自動的に再開されません）

---

<h3 id="ja-delay-queue">4. 3秒遅延キュー</h3>

弾幕として送信される前に翻訳内容を確認できるよう、各メッセージは **送信待ち** キューで約3秒間待機します。

#### 送信待ちエリア

キューにメッセージがあると、出力カードに赤い **⏳ 送信待ち** エリアが表示されます：

[Screenshot: 送信待ちキュー — 赤いヘッダー、各メッセージにカウントダウン秒数とスキップボタン]

- 各メッセージに残り待機時間が表示されます（例：`2s | 今日は天気がいいですね`）
- 右側に **スキップ** ボタンがあります

#### メッセージのスキップ

不適切な翻訳を見つけた場合、**スキップ** ボタンをクリックして送信をキャンセルできます。メッセージは破棄され、弾幕として送信されません。

#### 送信済みエリア

メッセージが正常に送信されると、緑の **✅ 送信済み** エリアに表示されます。最近5件まで表示されるので、送信された内容を確認できます。

---

<h3 id="ja-show-seq">5. 番号絵文字の切り替え</h3>

有効にすると、各弾幕の先頭に番号絵文字（0️⃣ 1️⃣ 2️⃣ ... 🔟）が付加され、視聴者がメッセージの順序を把握しやすくなります。

#### 使い方

1. 出力カード下部の **番号表示 0️⃣~🔟** チェックボックスを見つけます
2. チェックを入れると有効、外すと無効になります
3. 設定は自動的に保存されます

#### 表示例

有効化前：
```
【翻訳】みなさんこんにちは
【翻訳】今日は天気がいいですね
```

有効化後：
```
【翻訳】1️⃣ みなさんこんにちは
【翻訳】2️⃣ 今日は天気がいいですね
```

> 番号は 🔟 に達すると 0️⃣ に戻ります。番号はプレフィックスの後に表示されます。

---

<h3 id="ja-transcripts">6. 字幕記録のダウンロード</h3>

配信セッションごとに字幕記録ファイル（CSV形式）が自動生成され、原文と翻訳文がすべて記録されます。

#### ダウンロード方法

1. コントロールパネル下部の **📄 字幕記録** エリアまでスクロールします
2. **更新** ボタンをクリックしてファイル一覧を読み込みます
3. 必要なファイルを見つけ、**⬇ DL** をクリックします

[Screenshot: 字幕記録エリア — ファイル名、サイズ、日時、ダウンロードボタンのテーブル]

#### ファイル形式

ファイル名の形式：`ルームID_配信者名_日付_時刻.csv`

例：`12345_VTuberA_20260219_143000.csv`

CSVの列構成：

| 列 | 説明 |
|----|------|
| 時間 | 翻訳が行われた実際の時刻 |
| タイムライン | 配信開始からの経過時間 |
| 原文言語 | 例：`ja-JP` |
| 原文 | 音声認識された元の音声内容 |
| 翻訳先言語 | 例：`zh-CN` |
| 翻訳 | 翻訳されたテキスト |

> ファイルはUTF-8（BOM付き）で保存されるため、Excelで文字化けなく開けます。

> 一般ユーザーは割り当てられた配信ルームの字幕記録のみダウンロードできます。

---

<h3 id="ja-settings">7. 設定ページ（出力管理）</h3>

出力管理は管理パネルに統合されています。一般ユーザーと管理者の両方が、**📤 出力管理** セクションで権限のある配信ルームの出力を管理できます。

#### 管理パネルへのアクセス

コントロールパネル右上の **⚙️ 管理** ボタンをクリックします。

> 一般ユーザーは「📤 出力管理」セクションのみ表示されます。管理者はすべての管理機能にアクセスできます。

#### 出力の管理

[Screenshot: 出力管理 — 上部に配信者選択ドロップダウン、出力リストテーブル、下部に追加/編集フォーム]

1. **配信者を選択**：ドロップダウンから管理したい配信者を選びます
2. **既存の出力を確認**：テーブルに各出力の名前、プラットフォーム、翻訳先言語、アカウント、ルームID、プレフィックス、サフィックスが表示されます
3. **出力の追加/編集**：

| フィールド | 説明 |
|-----------|------|
| 名前 | 出力の表示名（例：「中文翻訳」） |
| プラットフォーム | 現在は `bilibili` のみ |
| ターゲット言語 | 翻訳先言語（空欄の場合は原文をそのまま転送） |
| アカウント | 1つまたは複数のBilibiliアカウントを選択（複数選択 = 輪番モード） |
| ルームID | 弾幕の送信先ルーム（0 = 配信者と同じルーム） |
| プレフィックス | 弾幕の先頭に付加するテキスト（例：`【翻訳】`） |
| サフィックス | 弾幕の末尾に付加するテキスト |

4. 入力が完了したら **保存** をクリックします
5. 出力を削除するには、該当行の **削除** ボタンをクリックします

> 新しく追加された出力はデフォルトで一時停止状態です。コントロールパネルで手動で再開してください。

---

<h3 id="ja-admin">8. 管理者機能</h3>

> 以下の機能は管理者のみ使用できます。

コントロールパネル右上の **⚙️ 管理** をクリックして管理パネルに移動します。

[Screenshot: 管理パネル概観 — 配信者管理、出力管理、ユーザー一覧、Bilibiliアカウント、操作ログの各セクション]

#### 📺 配信者管理

| 操作 | 説明 |
|------|------|
| 一覧 | 配信者名、ルームID、認識言語、出力一覧、コマンド許可リストのテーブル |
| 追加 | 配信者名、ルームID（URLまたは数字）、認識言語を入力して保存 |
| 編集 | **編集** ボタンをクリックすると、フォームに現在の設定が自動入力されます |
| 削除 | **削除** をクリックして確認 |
| コマンド許可リスト | 弾幕コマンドの使用を許可するBilibili UID（カンマ区切り） |

#### 👥 ユーザー管理

| 操作 | 説明 |
|------|------|
| 一覧 | ユーザー名、権限、割当済みアカウント、割当済みルームのテーブル |
| ユーザー追加 | ユーザー名、パスワード入力、管理者フラグ設定、Bilibiliアカウントとルームの割り当て |
| ユーザー編集 | **編集** をクリックしてパスワード変更、アカウント/ルームの再割り当てをポップアップで行います |
| ユーザー削除 | **削除** をクリックして確認（管理者アカウントは削除できません） |

#### 権限モデル

| 権限 | 配信ルーム | アカウント | 字幕記録 | 管理パネル |
|------|-----------|-----------|----------|-----------|
| 管理者 | すべて | すべて | すべて | フルアクセス |
| 一般ユーザー | 割当のみ | 割当のみ | 割当ルームのみ | 出力管理のみ |

#### 🎮 Bilibiliアカウント

弾幕送信に使用するBilibiliアカウントを管理します。

**アカウントの追加（QRコードログイン）：**

1. **📱 QRコードログイン** ボタンをクリックします
2. 画面にQRコードが表示されます
3. **Bilibiliスマホアプリ** でスキャンします
4. スマホでログインを確認します
5. 確認後、アカウントが自動的にリストに追加されます

[Screenshot: QRコードログイン — QRコード画像が中央に表示、「スキャン済み、スマホで確認してください」のステータステキスト]

**既存アカウントの管理：**

| 列 | 説明 |
|----|------|
| 名前 | アカウントのニックネーム |
| UID | BilibiliユーザーID |
| 最大文字数 | 弾幕1件あたりの最大文字数（デフォルト20、UL20+は30に設定可能） |
| 作成日 | アカウントが追加された日時 |
| ステータス | **有効** または **期限切れ** |

> 最大文字数はテーブル内で直接編集できます。変更は自動保存されます。

#### 📋 操作ログ

すべてのユーザーの操作を記録します：ログイン、一時停止/再開の切替、アカウントの追加/削除など。

1. 表示件数を選択します（最新50件 / 100件 / 500件）
2. **ログ読込** をクリックします
3. 日時、ユーザー、操作、詳細、IPアドレスを確認できます

---

<h3 id="ja-commands">9. 弾幕コマンド</h3>

Webページの操作に加えて、Bilibiliのライブチャットに直接コマンドを入力して翻訳を制御できます。

> 配信者のコマンド許可リストにBilibili UIDが登録されているユーザーのみ使用できます。

#### コマンド一覧

| コマンド | エイリアス | 機能 |
|---------|-----------|------|
| `/off` | `/pause` `/暂停` | すべての翻訳出力を一時停止 |
| `/on` | `/resume` `/恢复` | すべての翻訳出力を再開 |
| `/off 名前` | `/pause 名前` `/暂停 名前` | 特定の出力を一時停止（例：`/off 中文翻訳`） |
| `/on 名前` | `/resume 名前` `/恢复 名前` | 特定の出力を再開 |
| `/list` | `/列表` | すべての出力の ▶/⏸ 状態を表示 |
| `/help` | `/帮助` | コマンドのヘルプを表示 |

#### 使用例

Bilibiliのライブチャットに以下のように入力します：

- すべて停止：`/off` と送信
- 中国語出力のみ停止：`/off 中文翻訳` と送信
- すべて再開：`/on` と送信
- 現在の状態を確認：`/list` と送信 → ボットが `▶中文翻訳 | ⏸English` のように返信します

> コマンドへの返信はアカウントプールの輪番で送信されるため、高速かつレートリミット回避に効果的です。

---

<h3 id="ja-troubleshooting">10. よくある質問</h3>

#### ログインできない

- ユーザー名とパスワードが正しいか確認してください（大文字小文字を区別します）
- パスワードを忘れた場合は、管理者にリセットを依頼してください
- ブラウザがCookieを許可しているか確認してください

#### 配信ルームが表示されない

- 一般ユーザーには、管理者が割り当てたルームのみ表示されます
- 管理者に権限設定を確認してもらってください

#### 翻訳が弾幕として表示されない

- 出力が **一時停止** 状態（オレンジバッジ）になっていないか確認してください
- 配信者が **配信中**（赤いバッジ）であるか確認してください
- 翻訳には配信者の発話と音声認識の成功が必要です
- Bilibiliアカウントのステータスが **有効** であるか確認してください
- 新しく追加した出力はデフォルトで一時停止されているため、手動で再開してください

#### 弾幕のテキストが途切れる

- 弾幕には文字数制限があります（デフォルト20文字、UL20+アカウントは30文字に設定可能）
- 長い翻訳は自動的に複数の弾幕に分割して送信されます
- プレフィックスとサフィックスも文字数にカウントされます

#### 弾幕コマンドが反応しない

- あなたのBilibili UIDが配信者のコマンド許可リストに登録されているか確認してください
- コマンドは `/` で始める必要があります
- 配信者が現在配信中である必要があります

#### 字幕記録が見つからない

- 字幕記録エリアの **更新** ボタンをクリックしてください
- 字幕記録は配信中にのみ生成されます
- 一般ユーザーは割り当てられたルームの記録のみ閲覧できます

#### ページのデータが更新されない

- LiveSubはWebSocketによるリアルタイムのステータス配信を使用しています
- しばらく更新がない場合は、ページを再読み込みしてください
- バックグラウンドで5秒ごとのポーリングもフォールバックとして動作しています
